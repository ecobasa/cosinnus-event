{% extends "cosinnus_event/base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load static from staticfiles %}
{% block page_title %}Event{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    {% if event %}
        <li><a href="{% url 'cosinnus:event:entry' group=group.slug slug=event.slug %}">{{ event.title }}</a> <span class="divider">/</span></li>
        {% if form_view == 'edit' %}
            <li class="active">{% trans "Edit" %}</li>
        {% endif %}
    {% else %}
        <li class="active">{% trans "Add" %}</li>
    {% endif %}
{% endblock %}

{% block subnav_add_right %}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    {{ form.media.css }}
    {% for formset in inlines %}{{ formset.media.css }}{% endfor %}
{% endblock %}

{% block content %}
<div class="row event">
  <div class="span9">
    <form action="." method="post" class="form-horizontal" enctype="multipart/form-data">
    {% csrf_token %}
    {% if form_view == 'add' or form_view == 'edit' %}
    {% bootstrap_form form %}

    {% for formset in inlines %}
    <fieldset id="formset{{ formset.prefix }}">
        {{ formset.management_form }}
        <label class="control-label" for="">{% trans "Suggestions" %}</label>
        {% for inlineform in formset.forms %}
        <div class="control-group{% if inlineform.errors %} error{% endif %}">
            <div class="controls form-inline">
                {% with inlineform.from_date as field %}
                    <label{% if field.auto_id %} for="{{ field.auto_id }}"{% endif %}>{{ field.label }}</label>:
                    {{ field }}
                {% endwith %}
                {% with inlineform.to_date as field %}
                    <label{% if field.auto_id %} for="{{ field.auto_id }}"{% endif %}>{{ field.label }}</label>:
                    {{ field }}
                {% endwith %}
                {% with inlineform.DELETE as field %}
                    {{ field }}
                {% endwith %}
                {{ inlineform.id.as_widget }}
                {{ inlineform.event.as_widget }}
            </div>
        </div>
        {% endfor %}
    </fieldset>
    {% endfor %}

    <div class="control-group">
        <div class="controls">
            {% if not object %}
                <button type="submit" class="btn btn-primary">{% trans "Add" %}</button>
            {% else %}
                <button type="submit" class="btn btn-primary">{% trans "Save" context "sinn" %}</button>
            {% endif %}
            <a href="{% url 'cosinnus:event:list' group=group.slug %}" class="btn">{% trans "Cancel" %}</a>
        </div>
    </div>
    {% elif form_view == 'delete' %}
    <fieldset>
        <div class="control-group">
            <label class="control-label">{% trans "Are you sure to remove this event with all its suggestions and votes?" %}</label>
            <div class="controls">
                <button type="submit" class="btn btn-danger">{% trans "Delete" %}</button>
                <a href="{% url 'cosinnus:event:list' group=group.slug %}" class="btn">{% trans "Cancel" %}</a>
            </div>
        </div>
    </fieldset>
    {% endif %}
    </form>
  </div>
</div>
{% endblock %}

{% block extrafooter %}
{{ block.super }}
<script type="text/javascript" src="{% static "js/vendor/bootstrap3-typeahead.min.js" %}"></script>
{# for suggestions #}
<script type="text/javascript" src="{% static "js/vendor/bootstrap.inline.js" %}"></script>
{{ form.media.js }}
{% for formset in inlines %}{{ formset.media.js }}{% endfor %}


<script type="text/javascript">
{% for formset in inlines %}
   $(function() {
       $('#formset{{ formset.prefix }} div.control-group').formset({
            addCssClass: 'add-row btn',
            addText: '<i class="icon-plus"></i> {% trans "Add suggestion" %}',
            deleteCssClass: 'delete-row',
            deleteText: '<i class="icon-remove"></i>',
            insertAddInSelector: true,
            insertDeleteAfter: 'div.controls.form-inline',
            prefix: '{{ formset.prefix }}',
       });
   });
{% endfor %}

{% if not event %}
$("#id_title").focus();
{% endif %}

$(function() {
  var tags = [{% for tag in tags %}"{{ tag }}", {% endfor %}];
  $('#id_tags')
    .attr('data-provide', 'typeahead')
    .attr('autocomplete', 'off')
    .typeahead({
      source: tags,
    });
});
</script>
{% endblock %}
