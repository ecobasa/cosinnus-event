{% extends "cosinnus_event/base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load static from staticfiles %}


{% block page_title %}
{% if form_view == "add" %}
  {% trans "Add event" %}
{% elif form_view == "edit" %}
  {% trans "Edit" %} {{ event.title }}
{% elif form_view == "delete" %}
  {% trans "Delete" %} {{ event.title }}
{% endif %}
{{ block.super }}
{% endblock page_title %}


{% block extrahead %}
{{ block.super }}
{{ form.media.css }}
{% for formset in inlines %}{{ formset.media.css }}{% endfor %}
{% endblock extrahead %}


{% block content_title %}
{{ group.name }}:
{% if form_view == "add" %}
  {% trans "Add event" %}
{% elif form_view == "edit" %}
  {% trans "Edit" %} {{ event.title }}
{% elif form_view == "delete" %}
  {% trans "Delete" %} {{ event.title }}
{% endif %}
{% endblock content_title %}



{% block content %}
<div class="cosinnus-event">
  <form action="." method="post" class="form-inline" enctype="multipart/form-data">
  {% csrf_token %}

  {% if form_view == 'add' or form_view == 'edit' %}
  <div class="row">
    <div class="col-md-6">
    {% bootstrap_field form.title %}
    {% bootstrap_field form.note %}
    {% bootstrap_field form.tags %}
    {% bootstrap_field form.public %}
    {% bootstrap_field form.image %}
    {% bootstrap_field form.url %}

      {% for formset in inlines %}
      <fieldset id="formset{{ formset.prefix }}">
          {{ formset.management_form }}
          <label class="control-label" for="">{% trans "Suggestions" %}</label>
          {% for inlineform in formset.forms %}
          <div class="control-group{% if inlineform.errors %} error{% endif %}">
              <div class="controls form-inline">
                  {% with inlineform.from_date as field %}
                      <label{% if field.auto_id %} for="{{ field.auto_id }}"{% endif %}>{{ field.label }}</label>:
                      {{ field }}
                  {% endwith %}
                  {% with inlineform.to_date as field %}
                      <label{% if field.auto_id %} for="{{ field.auto_id }}"{% endif %}>{{ field.label }}</label>:
                      {{ field }}
                  {% endwith %}
                  {% with inlineform.DELETE as field %}
                      {{ field }}
                  {% endwith %}
                  {{ inlineform.id.as_widget }}
                  {{ inlineform.event.as_widget }}
              </div>
          </div>
          {% endfor %}
      </fieldset>
      {% endfor %}
    </div>
    <div class="col-md-5 pull-right">
    {% bootstrap_field form.location %}
    {% bootstrap_field form.street %}
    {% bootstrap_field form.zipcode %}
    {% bootstrap_field form.city %}
    </div>
  </div>

  <div class="control-group">
      <div class="controls">
          {% if not object %}
              <button type="submit" class="btn btn-primary">{% trans "Add" %}</button>
          {% else %}
              <button type="submit" class="btn btn-primary">{% trans "Save" context "sinn" %}</button>
          {% endif %}
          <a href="{% url 'cosinnus:event:list' group=group.slug %}" class="btn">{% trans "Cancel" %}</a>
      </div>
  </div>

  {% elif form_view == 'delete' %}
  <div class="control-group">
      <label class="control-label">
        <h3>{% trans "Are you sure to remove this event with all its suggestions and votes?" %}</h3>
      </label>
      <div class="controls">
          <button type="submit" class="btn btn-danger">{% trans "Delete" %}</button>
          <a href="{% url 'cosinnus:event:list' group=group.slug %}" class="btn">{% trans "Cancel" %}</a>
      </div>
  </div>
  {% endif %}

  </form>
</div>
{% endblock content %}


{% block extrafooter %}
{{ block.super }}
{{ form.media.js }}
{% for formset in inlines %}{{ formset.media.js }}{% endfor %}
<script type="text/javascript" src="{% static "js/vendor/bootstrap3-typeahead.min.js" %}"></script>
{# for suggestions #}
<script type="text/javascript" src="{% static "js/vendor/bootstrap.inline.js" %}"></script>
<script type="text/javascript">
{% for formset in inlines %}
   $(function() {
       $('#formset{{ formset.prefix }} div.control-group').formset({
            addCssClass: 'add-row btn',
            addText: '<span class="glyphicon glyphicon-plus"></span> {% trans "Add suggestion" %}',
            deleteCssClass: 'delete-row',
            deleteText: '<span class="glyphicon glyphicon-remove"></span>',
            insertAddInSelector: true,
            insertDeleteAfter: 'div.controls.form-inline',
            prefix: '{{ formset.prefix }}',
       });
   });
{% endfor %}

$(function() {
  var tags = [{% for tag in tags %}"{{ tag }}", {% endfor %}];
  $('#id_tags')
    .attr('data-provide', 'typeahead')
    .attr('autocomplete', 'off')
    .typeahead({
      source: tags,
    });

{% if not event %}
  $("#id_title").focus();
{% endif %}
});
</script>
{% endblock extrafooter %}
